/*
 *  Content Edit - v0.1.1
 *  HTML Content Edit (jQuery) plugin. To edit content with a more complex workflow than just an inline editable.
 *  https://github.com/oncletom/content-edit
 *
 *  Made by Thomas Parisot
 *  Under Apache-2.0 License
 */
!function(a){"use strict";function b(c,d){this.options=a.extend({},b.defaults,d),this.state="idle",this.previousState=this.state,this.sourceElement=null,this.templateElement=null,this.plugins={},this.value="",this.oldValue="",this.init(c),this.initEvents()}b.prototype.init=function(b){b.hasAttribute("data-editable")||(b.setAttribute("data-editable",""),this.options.identifier&&b.setAttribute("data-editable-template",this.options.identifier)),this.sourceElement=b,this.templateElementLookup(this.sourceElement),a(this.sourceElement).trigger("editable.construct",[this])},b.prototype.selector=function(a){return"[data-editable-%ns%='%id%']".replace("%ns%",a).replace("%id%",this.templateElement.getAttribute("data-editable-template")||"")},b.prototype.initEvents=function(){var b=a(this.sourceElement);b.on("editable.editing",a.proxy(this.startEdit,this)),b.on("editable.idle",a.proxy(this.endEdit,this)),b.on("editable.saving",a.proxy(this.onSave,this))},b.prototype.startEdit=function(){var b=a(this.templateElement),c=a(this.sourceElement).html(),d=this.options.overwriteDefaultContent;b.data("editable-source",this),(d||!d&&""===this.getContent())&&(this.setContent(c),b.find(".original-content").text(c)),b.removeClass(this.options.visibilityTogglingClass)},b.prototype.endEdit=function(){a(this.templateElement).data("editable-source",null),a(this.templateElement).addClass(this.options.visibilityTogglingClass).find(".original-content").text("").end(),this.setContent("")},b.prototype.onSave=function(){var a=this.getContent();a!==this.value&&(this.oldValue=this.value,this.value=a)},b.prototype.getContent=function(){return a(this.templateElement).find("[data-editable-content]").val()},b.prototype.setContent=function(b){b=this.applyFilters(b,this.options.inputFilters),a(this.templateElement).find("[data-editable-content]").val(b),this.oldValue=this.value,this.value=b},b.prototype.templateElementLookup=function(b){var c=b.getAttribute("data-editable-template")||"";return this.templateElement=a("form[data-editable-template='"+c+"']").get(0),this.templateElement},b.prototype.setState=function(c){if(c===this.state||!~b.states.indexOf(c))return!1;var d=a(this.sourceElement);this.previousState=this.state,this.state=c,d.trigger("editable.any",[this]).trigger("editable."+this.state,[this]),d.add(this.templateElement).removeClass("editable-"+this.previousState).addClass("editable-"+this.state)},b.prototype.applyFilters=function(b,c){return a.isArray(c)||(c=a.isFunction(c)?[c]:[]),a.each(c,function(c,d){a.isFunction(d)&&(b=d(b))}),b},b.defaults={identifier:"",inputFilters:["trim"in String.prototype&&function(a){return a.trim()},function(a){return a.replace("&gt;",">").replace("&lt;","<")}],overwriteDefaultContent:!1,preventDefault:{a:!0,form:!1},visibilityTogglingClass:"hidden"},b.states=["idle","editing","saving"],b.findContextSource=function(b){var c,d=a(b);return b?(b.hasAttribute("data-editable-template")&&!b.hasAttribute("data-editable")&&(c=b),!c&&d.parents("form[data-editable-template]").length&&(c=d.parents("form[data-editable-template]").get(0)),!c&&d.find("form[data-editable-template]").length&&(c=d.find("form[data-editable-template]").get(0)),a(c)):d},b.UISubmitHandler=function(a){var c=b.findContextSource(this).data("editable-source");c.options.preventDefault.form&&a.preventDefault(),c.setState("saving")},b.UICancelHandler=function(a){var c=b.findContextSource(this).data("editable-source");c.options.preventDefault.a&&a.preventDefault(),c.setState("idle")},b.UIEDitHandler=function(b){var c,d=(this.getAttribute("href")||"").trim();b.preventDefault(),c="#"===d[0]&&a(d).get(0)||this,a(c).editable()},b.dispatch=function(a){a.on("click","[data-editable]",b.UIEDitHandler),a.on("submit","[data-editable-template]",b.UISubmitHandler),a.on("click","[data-editable-template] [type='submit']",b.UISubmitHandler),a.on("click","[data-editable-template] [data-toggle='cancel']",b.UICancelHandler)},a.fn.editable=function(c){return this.each(function(){a.data(this,"plugin_editable")||a.data(this,"plugin_editable",new b(this,"object"==typeof c&&c)),("string"==typeof c||void 0===c)&&a.data(this,"plugin_editable").setState(c||"editing")})},a.fn.editable.Constructor=b,b.dispatch(a(document))}(jQuery,document,window);